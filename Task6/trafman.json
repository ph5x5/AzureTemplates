{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"envLocation": {
			"type": "string"
		},
		"tmName": {
			"type": "string"
		},
		"profileStatus": {
			"type": "string"
		},
		"routingMethod": {
			"type": "string"
		},
		"relativeName": {
			"type": "string"
		},
		"ttl": {
			"type": "int"
		},
		"protocol": {
			"type": "string"
		},
		"port": {
			"type": "int"
		},
		"path": {
			"type": "string"
		},
		"webSite1": {
			"type": "string"
		},
		"webSite2": {
			"type": "string"
		},
		"loop1": {
			"type": "string"
		},
		"loop2": {
			"type": "string"
		}
	},
	"variables": {
		"webAppLocations": [
			"West Europe",
			"North Europe"
		]
	},
	"resources": [
		{
			"name": "[parameters('tmName')]",
			"type": "Microsoft.Network/trafficManagerProfiles",
			"location": "[parameters('envLocation')]",
			"apiVersion": "2015-11-01",
			"properties": {
				"profileStatus": "[parameters('profileStatus')]",
				"trafficRoutingMethod": "[parameters('routingMethod')]",
				"dnsConfig": {
					"relativeName": "[parameters('relativeName')]",
					"ttl": "[parameters('ttl')]"
				},
				"monitorConfig": {
					"protocol": "[parameters('protocol')]",
					"port": "[parameters('port')]",
					"path": "[parameters('path')]"
				}
			}
		},
		{
			"name": "[concat(parameters('tmName'), '/ep1')]",
			"type": "Microsoft.Network/trafficManagerProfiles/azureEndpoints",
			"location": "[parameters('envLocation')]",
			"apiVersion": "2015-11-01",
			"dependsOn": [
				"[parameters('tmName')]",
				"[parameters('webSite1')]"
			],
			"copy": {
				"name": "[parameters('loop1')]",
				"count": "[length(variables('webAppLocations'))]"
			},
			"properties": {
				"targetResourceId": "[parameters('webSite1')]",
				"endpointStatus": "Enabled"
			}
		},
		{
			"name": "[concat(parameters('tmName'), '/ep2')]",
			"type": "Microsoft.Network/trafficManagerProfiles/azureEndpoints",
			"location": "[parameters('envLocation')]",
			"apiVersion": "2015-11-01",
			"dependsOn": [
				"[parameters('tmName')]",
				"[parameters('webSite2')]"
			],
			"copy": {
				"name": "[parameters('loop2')]",
				"count": "[length(variables('webAppLocations'))]"
			},
			"properties": {
				"targetResourceId": "[parameters('webSite2')]",
				"endpointStatus": "Enabled"
			}
		}
	],
	"outputs": { }
}